!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("func",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("jsCore/rpcLogin"),g=require("jsCore/plugin");require("jsCore/modules/minPtzControl");var h=require("jsCore/hlsplayer"),i=require("jsCore/flashplayer"),j=require("jsCore/h5player"),k=null,l=null,m=0,n=0,o=0,p=0,q=null,r={Support:!1,TaskNum:8,Action:["Preset","Tour","Pattern","AutoScan"],SupportSnapShot:!1},s=null,t=null,u=null,v=null,w=!0,x=!0,y=!0,z=!0,A=0,B=0,C=0,D=[],E="",F="",G="",H="",I=0,J=!1,K=null,L=["Preset","Scan","Pattern","Tour"],M=["Preset","Scan","Pattern","Tour","Auto"],N={Preset:"com.AddPresetFirstTip",Tour:"com.AddTourFirstTip",Scan:"com.AddScanFirstTip",Pattern:"com.AddPatternFirstTip",AutoPanGroup:"addAutoPanGroupFirst",Auto:"addAutoFirst"},O=/^[^'"\|\&]*$/;c.exports=e.extend({init:function(){k=this,k._initPtz(),require.async("jsCore/pageTab",function(a){I=1,k.$("#func_content").data("funcTab",new a({element:k.$("#func_content")}))}),-1!==webApp.DeviceType.indexOf("TPC")?webApp.CHANNEL_NUMBER>1?k.$("#function_vedioControl_window").removeClass("fn-hide"):k.$("#function_vedioControl_window").parent().parent().addClass("fn-hide"):g.CheckFuncSupport(2).done(function(b){b&&a("#function_vedioControl_full").removeClass("fn-hide")}),k.render()},render:function(){"hls"==webApp.playMode?(a(".ui-video-iconbar-hls").hide(),h&&h.cover(a("#func_video")),g.hide(),h&&(h.init("","",""),h.beginPlay())):"flash"==webApp.playMode?(a(".ui-video-iconbar-hls").hide(),k.$(".ui-video-bar,.camera-video-iconbar").hide(),i&&i.cover(a("#func_video")),g.hide(),i&&i.playPreview(1,0)):"h5"===webApp.playMode?(a(".ui-video-iconbar-hls").hide(),k.$(".ui-video-bar,.camera-video-iconbar").hide(),g.hide(),j&&j.playPreview(1,0,a("#func_video"))):(g.SetIVSDrawingEnable(!1),g.cover("#func_video",function(){g.SetRegionNum(0),g.SetModuleMode(1),-1===webApp.DeviceType.indexOf("TPC")?g.open():"thermal"===webApp.CHANNEL_TYPE[1]?(f.chkAuthority("Monitor_02")?(g.SetVisibleVideoWnd(1,1),g.ConnectRealVideoEx(1,1,0)):(g.SetVisibleVideoWnd(1,0),g.SetVideoWndTip(0,tl("noVideoAuthoity"))),a("#function_vedioControl_window").removeClass("ui-video-icon-current"),k.$("#func_PTZ").minPtzControl("changeChannel",g.windowId)):f.chkAuthority("Monitor_01")?(g.SetVisibleVideoWnd(1,0),g.ConnectRealVideoEx(0,0,0)):(g.SetVisibleVideoWnd(1,0),g.SetVideoWndTip(0,tl("noVideoAuthoity")))}));var b=k.$(".js-tab"),c=k.$(".u-tab-content");ability.get("PTZCaps",!0).done(function(d){l=d,m=l.PresetMax-l.PresetMin+1,n=l.TourMax-l.TourMin+1,o=l.PatternMax-l.PatternMin+1,p=l.AutoScanMax-l.AutoScanMin+1||5,q=l.AutoPanGroup||0,l.PtzAutoMovement&&(r.Support=l.PtzAutoMovement.Support?!0:!1,r.TaskNum=l.PtzAutoMovement.TaskNum||8,r.Action=l.PtzAutoMovement.Action||["Preset"],r.SupportSnapShot=l.PtzAutoMovement.SupportSnapShot?!0:!1),l.IdleMotion&&l.IdleMotion.Action&&(L=l.IdleMotion.Action),l.PowerUp&&l.PowerUp.Action&&(M=l.PowerUp.Action),webApp.isSpecialPtz?(b.find("[data-for=func_hfmr]").remove(),c.find("[data-page=func_hfmr]").remove(),b.find("[data-for=func_ytcq]").remove(),c.find("[data-page=func_ytcq]").remove(),a.when(ability.get("PtzAutoMovement"),ability.get("IdleMotion")).then(function(a,d){a&&a.Support?(r=a,r.SupportSnapShot=!1):(b.find("[data-for=func_dsrw]").remove(),c.find("[data-page=func_dsrw]").remove()),d&&d.Support?L=d.Action:(b.find("[data-for=func_kxdz]").remove(),c.find("[data-page=func_kxdz]").remove())})):l.IdleMotion&&l.IdleMotion.Support||(b.find("[data-for=func_kxdz]").remove(),c.find("[data-page=func_kxdz]").remove()),l.Tour||(b.find("[data-for=func_zdxh]").remove(),c.find("[data-page=func_zdxh]").remove()),l.Pattern||(b.find("[data-for=func_zdxj]").remove(),c.find("[data-page=func_zdxj]").remove()),l.AutoScan||(b.find("[data-for=func_zdxs]").remove(),c.find("[data-page=func_zdxs]").remove()),l.AutoPan||q&&-1!==webApp.DeviceType.indexOf("TPC")||(b.find("[data-for=func_spxz]").remove(),c.find("[data-page=func_spxz]").remove()),l.PowerUp||(b.find("[data-for=func_kjdz]").remove(),c.find("[data-page=func_kjdz]").remove());var e=0;if(l.PtzLimit){var f=l.PtzLimit;for(var g in f)g&&(a('a[data-cap="'+g+'"]').removeClass("fn-hide"),a('label[data-cap="'+g+'"]').removeClass("fn-hide")),e++}-1===webApp.DeviceType.indexOf("TPC")&&(l.PtzLimit&&l.PtzLimit.Support&&e>1||l.PtzElevation&&l.PtzElevation.Support)&&b.find("[data-for=func_limit]").removeClass("fn-hide"),-1===webApp.DeviceType.indexOf("TPC")&&l.PtzPowerLevel&&l.PtzPowerLevel.Support||(b.find("[data-for=func_zsdh]").remove(),c.find("[data-page=func_zsdh]").remove()),l.PtzIntelli&&(l.PtzIntelli.SupportPanoramicTrace||l.PtzIntelli.TrackOverProcessDelay&&l.PtzIntelli.TrackOverProcessDelay.Support)?(K=l.PtzIntelli,b.find("[data-for=func_ytzn]").removeClass("fn-hide")):(b.find("[data-for=func_ytzn]").remove(),c.find("[data-page=func_ytzn]").remove()),b.find("[data-for=func_jxcq]").remove(),c.find("[data-page=func_jxcq]").remove(),(l.PtzSpeed&&!l.PtzSpeed.Support||webApp.isSpecialPtz)&&(b.find("[data-for=func_ytsd]").remove(),c.find("[data-page=func_ytsd]").remove()),l.AutoScanSpeed===!1&&k.$("#zdxsSlider").parent().addClass("fn-hide"),l&&l.TourSpeed&&(J=!0)}),1==I?I=0:k.$("#func_content").data("funcTab").current.render(!1)},_initPtz:function(){k.$("#func_PTZ").minPtzControl("init");var b=function(){var a=k.$("#func_content").data("funcTab").tabs;for(var b in a)"func_spxz"===b&&z===!1?a[b].render():"func_zdxh"===b&&w===!1?a[b].render():"func_zdxs"===b&&x===!1?a[b].render():"func_zdxj"===b&&y===!1&&a[b].render()};a("#func_PTZ #miniPtzBoat a[boatCmd],#func_PTZ #miniPtzAdjust a[cmd]").on("click",function(){setTimeout(b,1e3)})},onChangeVideo:function(b){var c=a(b.target).parent();c.hasClass("ui-video-icon-current")?(c.removeClass("ui-video-icon-current"),k.$("#function_vedioControl_focus").hide(),f.chkAuthority("Monitor_02")?(g.SetVisibleVideoWnd(1,1),g.ConnectRealVideoEx(1,1,0)):(g.SetVisibleVideoWnd(1,0),g.SetVideoWndTip(0,tl("noVideoAuthoity")))):(c.addClass("ui-video-icon-current"),ability.get("PTZCaps").done(function(a){a&&a.SupportRegionFocus&&k.$("[btn-for=onRegionFocus]").show()}),f.chkAuthority("Monitor_01")?(g.SetVisibleVideoWnd(1,0),g.ConnectRealVideoEx(0,0,0)):(g.SetVisibleVideoWnd(1,0),g.SetVideoWndTip(0,tl("noVideoAuthoity")))),k.$("#func_PTZ").minPtzControl("changeChannel",g.windowId)},onFullScreen:function(){g.SetFullScreen()},onRegionFocus:function(){g.activeLocalFocus(k.$("[btn-for=onRegionFocus]"))},leave:function(){a("#func_content ul li").eq(0).trigger("click"),g.hide(),h&&h.hideAndStopLoad(),i&&i.hide(),j&&j.hide()}});var P={_gotoPreset:function(a,b){a=~~a,d.PTZ.gotoPreset(a).done(function(a){w=!0,x=!0,y=!0,z=!0,a&&a.result&&b&&b()}).fail(function(){var a=k.$("#func_content").data("funcTab").current.element.data("page");k.$("#"+a+"_tip").tip("error",tl("com.OperateFailTip"))})},_getPtzPresets:function(a){return d.PTZ.getPresets().done(function(b){if(s=b||[],a)if(E="",0===s.length)E+='<option value="-1">'+tl("com.AddPresetFirstTip")+"</option>";else for(var c=0;c<s.length;c++)E+='<option value="'+s[c].Index+'">'+s[c].Index+" : "+s[c].Name+"</option>"})},_getTourList:function(a){return d.ConfigManager.getConfig("PtzTour").done(function(b){if(t=b[0],a){F="";for(var c=t.length>n?n:t.length,d=0;c>d;d++)t[d].Enable&&(F+='<option value="'+(d+1)+'">'+(d+1)+":"+t[d].Name+"</option>");""===F&&(F+='<option value="-1">'+tl("com.AddTourFirstTip")+"</option>")}})},_getScanList:function(a){return d.ConfigManager.getConfig("AutoScan").done(function(b){if(u=b[0],a){G="";for(var c=0;c<u.length;c++)u[c].LeftEnable&&u[c].RightEnable&&(G+='<option value="'+(c+1)+'">'+(c+1)+"</option>");""===G&&(G+='<option value="-1">'+tl("com.AddScanFirstTip")+"</option>")}})},_getPatternList:function(a){return d.ConfigManager.getConfig("AutoPattern").done(function(b){if(v=b[0],a){H="";for(var c=0;c<v.length;c++)v[c].Enable&&(H+='<option value="'+(c+1)+'">'+(c+1)+"</option>");""===H&&(H+='<option value="-1">'+tl("com.AddPatternFirstTip")+"</option>")}})},_getPtzCurmove:function(){return d.ConfigManager.getConfig("PtzMovement")},_stopPtz:function(){w||(w=!0,d.PTZ.stopTour(A+1)),x||(x=!0,d.PTZ.stopScan(C+1)),y||(y=!0,d.PTZ.stopPatternReplay(B+1)),z||(z=!0,d.PTZ.start("AutoPanOff",0,0,0))}};define("func_yzd",function(require,b,c){var f=null,h=null,i=[],j=!0,k=null,n=null,o=[];c.exports=e.extend({init:function(){f=this,h=f.$("#func_yzd_list_table").table({height:200,reSelectRow:!0,pressEnter:!1,columns:[{t:"com.Number",width:"20%",fields:"Index",editor:function(){return a('<input type="text" class="u-input"/>').numberfield({min:l.PresetMin||1,max:l.PresetMax,allowDecimal:!1,allowNegative:!1})}},{t:"ivs.PresetsTitle",fields:"Name",width:"40%",editor:function(){return a('<input type="text" class="u-input"/>').textfield({length:63,asciiByte:2,notAsciiByte:3,validReg:O,errorHandle:"prevent",error:function(){f.$("#func_yzd_tip").tip("error",tl("com.LimitStringInput"))}})}},{t:"adv.Save",width:"20%",action:"saveyzd",icon:"i-save",preventEvt:!0,handle:function(b){setTimeout(function(){return b.Name=a.htmlEscapeReverse(b.Name),O.test(b.Name)?(k=~~b.Index,void f._setPreset(b)):void f.$("#func_yzd_tip").tip("error",tl("com.LimitStringInput"))},100)}},{t:"com.Delete",width:"20%",action:"deleteyzd",icon:"i-del",preventEvt:!0,handle:function(b){1===b.Type?(g.hide(),a.confirm(tl("com.Ok"),tl("com.PresetTip1"),function(){f._deletePresent(b),g.cover("#func_video")},function(){g.cover("#func_video")})):f._deletePresent(b)}}],onRowSelect:function(b,c){-1!==a.inArray(~~c.data.Index,o)&&P._gotoPreset(c.data.Index)},onblurEditor:function(b,c){if("Index"===c.field){n=~~c.data.Index,k=~~c.editVal;var e=o.indexOf(n);if(-1!==a.inArray(k,o)&&k!==n)return c.editVal=n,f.$("#func_yzd_tip").tip("error",tl("com.PresetExistTip")),!1;-1!==e&&n!==k&&d.PTZ.removePreset(n).done(function(){o.splice(e,1),n=null,f._savePreset(k,c.data.Name,!0)})}else if("Name"===c.field)return c.editVal=a.htmlEscapeReverse(c.editVal),O.test(c.editVal)?(c.editVal=a.htmlEscape(c.editVal),c.data.Name=c.editVal,i.each(function(a){return a.Index===c.data.Index?(a.Name=c.data.Name,!1):void 0}),h.table("dataSource",i),!1):(f.$("#func_yzd_tip").tip("error",tl("com.LimitStringInput")),!1)}}),f.render()},render:function(b){f._emptyTable(),P._getPtzPresets().done(function(){o=[],0!==s.length&&(a.extend(!0,[],s).each(function(b){o.push(b.Index),b.Name=a.htmlEscape(b.Name),i.push(b)}),h.table("dataSource",i),i.each(function(b,c){if(1===b.Type){var d=h.table("getRowElement",c);a(d).addClass("fn-color-ivsGreen")}})),b&&f.$("#func_yzd_tip").tip("success",tl("com.OperateSuccessTip"))})},_emptyTable:function(){i=[],h.table("dataSource",i)},_setPreset:function(b){var c=(h.table("dataSource"),-1!==a.inArray(~~b.Index,o)?!1:!0);f._savePreset(~~b.Index,b.Name,c)},_savePreset:function(b,c,e){j?(j=!1,d.PTZ.setPreset(b,c).done(function(){f.$("#func_yzd_tip").tip("success",tl("com.OperateSuccessTip")),e&&o.push(b),j=!0,i.each(function(b){b.Name=a.htmlEscape(b.Name)}),h.table("dataSource",i)}).fail(function(){j=!0,f.$("#func_yzd_tip").tip("error",tl("com.OperateFailTip"))})):f.$("#func_yzd_tip").tip("error",tl("com.PleasewaitsettingpresetTip"))},_deletePresent:function(b){return d.PTZ.removePreset(~~b.Index).done(function(c){c&&c.result?(h.table("del",b),o.splice(o.indexOf(b.Index),1),i.each(function(b,c){if(1===b.Type){var d=h.table("getRowElement",c);a(d).addClass("fn-color-ivsGreen")}}),f.$("#func_yzd_tip").tip("success",tl("com.OperateSuccessTip"))):f.$("#func_yzd_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_yzd_tip").tip("error",tl("com.OperateFailTip"))}),!1},onPresetAdd:function(){var b=0;if(i.length<m){i.sort(function(a,b){return a.Index-b.Index});for(var c=0;c<i.length;c++)if(i[c].Index!=c+1){b=c+1;break}0===b&&(b=i.length+1);var d={Index:b,Name:tl("ivs.Preset")+b};h.table("add",d,b-1).table("selectRow",b-1),i.each(function(b,c){if(1===b.Type){var d=h.table("getRowElement",c);a(d).addClass("fn-color-ivsGreen")}});var e=a("#func_yzd_list_table .u-table-main").scrollTop(),g=a("#func_yzd_list_table tbody").find('[data-index="'+(b-1)+'"]').offset().top;a("#func_yzd_list_table .u-table-main").scrollTop(e+g)}else f.$("#func_yzd_tip").tip("warning",tl("com.NoMorePresetTip"))},onPresetRefresh:function(){f.render(!0)},onPresetClean:function(){g.hide(),a.confirm(tl("com.Ok"),tl("com.ClearAllPresetsConfirmTip"),function(){d.PTZ.removePreset(0).done(function(a){a&&a.result&&(s=[],o=[],f._emptyTable(),f.$("#func_yzd_tip").tip("success",tl("com.OperateSuccessTip")))}).always(function(){g.cover("#func_video")}),g.hide()},function(){g.cover("#func_video")})}})}),define("func_zdxh",function(require,b,c){var f=null,g=null,h=null,i=[],j=[],k=0,l={},o=[-1,15,7],p=15,q=!1,r=0;c.exports=e.extend({init:function(){f=this,g=f.$("#func_tour_list_table").table({height:220,pressEnter:!1,columns:[{t:"ivs.TourNumber",width:"30%",fields:"Index",render:function(a){return a.Index+1}},{t:"ivs.TourName",width:"40%",fields:"Name",editor:function(){return a('<input type="text" class="u-input"/>').textfield({length:63,asciiByte:2,notAsciiByte:3,validReg:O,errorHandle:"prevent",error:function(){f.$("#func_zdxh_tip").tip("error",tl("com.LimitStringInput"))}})}},{t:"com.Delete",width:"30%",action:"deletetour",icon:"i-del",handle:function(b){this.del(b),k--,0===k&&(a("#func_tour_start").addClass("ui-button-special-disabled").off(),f._emptyTourPointTable())}}],onRowSelect:function(a,b){A!==b.data.Index&&(f._savePrevTourPoint(),A=b.data.Index),f._showTourPointList(A)},onblurEditor:function(b,c){switch(c.field){case"Name":return c.editVal=a.htmlEscapeReverse(c.editVal),O.test(c.editVal)?(c.editVal=a.htmlEscape(c.editVal),c.data.Name=c.editVal,g.each(function(a){return a.Index===c.data.Index?(a.Name=c.data.Name,!1):void 0}),g.table("dataSource",i),!1):(f.$("#func_zdxh_tip").tip("error",tl("com.LimitStringInput")),!1)}}}),a.when(ability.get("SupportSetPtzTour"),ability.get("SupportShortTour")).done(function(b,c){b&&b.PtzTourMinInterval&&(p=b.PtzTourMinInterval),c&&(q=!0,a("#func_zdxh_mode").parent().removeClass("fn-hide")),f.render()})},render:function(){d.ConfigManager.getDefault("PtzTour").done(function(a){var b=a[0],c=0;o[1]=b[c].Presets[c][1],o[2]=b[c].Presets[c][2]}),P._getPtzCurmove().done(function(a){w=-1===a[0].Function.indexOf("Tour"),f.$("#func_tour_start").toggle(w),f.$("#func_tour_stop").toggle(!w),w?f._tourNormalStatus():(f._onTourEstopAll(),A=a[0].Index)}),l={};var a={};P._getPtzPresets().done(function(){s.each(function(b){l[b.Index]=b.Name,a[b.Index]=b.Index}),f._initTourPointTable(a),f._getTourConfig()})},_getTourConfig:function(b){P._getTourList().done(function(){if(f._emptyTourTable(),f._emptyTourPointTable(),t.each(function(b,c){if(b.Enable){var d={Index:c,Name:a.htmlEscape(b.Name),tourPoint:[]};b.Presets.each(function(a){-1!==a[0]&&a[0]+1 in l&&d.tourPoint.push({preset:a[0]+1,duration:a[1],speed:a[2]})}),i.push(d)}}),q&&a("#func_zdxh_mode").val(t[0].Path),k=i.length,0!==i.length){var c=A,d=0;a.each(i,function(a,b){return b.Index===A?(c=a,!1):void(d+=1)}),i.length>n&&(i.length=n),d===k&&(c=0),g.table("dataSource",i).table("selectRow",c)}else a("#func_tour_start").addClass("ui-button-special-disabled").off();b&&f.$("#func_zdxh_tip").tip("success",tl("com.OperateSuccessTip"))})},_initTourPointTable:function(b){var c={};c=J?{number:"10%",Preset:"40%",Duration:"20%",Speed:"20%",Delete:"10%"}:{number:"15%",Preset:"45%",Duration:"25%",Delete:"15%"},h=f.$("#func_tourpoint_list_table").table({height:220,pressEnter:!1,columns:[{t:"com.Number",width:c.number,render:function(a){return a._index+1}},{t:"ivs.Preset",width:c.Preset,fields:"preset",valueMap:b,editor:function(b,c){var d="",e=c.valueMap;if(e){d="<select>";for(var f in e)d+='<option value="'+f+'">'+f+":"+l[f]+"</option>";d+="</select>"}return a(d)}},{t:"ivs.Duration",width:c.Duration,fields:"duration",editor:function(){return a('<input type="text" class="u-input" />').numberfield({min:p,max:3600,allowDecimal:!1,allowNegative:!1})}},{t:"itc.Speed",width:c.Speed,fields:"speed",hide:!J,editor:function(){return a('<input type="text" class="u-input" />').numberfield({min:1,max:10,allowDecimal:!1,allowNegative:!1})}},{t:"com.Delete",width:c.Delete,action:"deletepoint",icon:"i-del",handle:function(a){this.del(a)}}],onRowSelect:function(a,b){w&&P._gotoPreset(~~b.data.preset)},onblurEditor:function(a,b){b&&"preset"===b.field&&P._gotoPreset(~~b.editVal)}})},_emptyTourTable:function(){i=[],g.table("dataSource",i)},_emptyTourPointTable:function(){j=[],h.table("dataSource",j)},_onTourEstopAll:function(){a("#maskZdxhTourTable,#maskZdxhPointTable,#maskZdxhSelect").removeClass("mask").addClass("mask-show-tour"),a("#func_tour_add").addClass("ui-button-special-disabled").off(),a("#func_tourpoint_add").addClass("ui-button-special-disabled").off(),a("#func_tour_confirm").addClass("ui-button-special-disabled").off(),a("#func_tour_refresh").addClass("ui-button-special-disabled").off(),f.$("#func_zdxh_tip").tip("warning",tl("com.IsTouringTip"))},_tourNormalStatus:function(){a("#maskZdxhTourTable,#maskZdxhPointTable,#maskZdxhSelect").removeClass("mask-show-tour").addClass("mask"),a("#func_tour_add").removeClass("ui-button-special-disabled").off().on("click",f.onTourAdd),a("#func_tourpoint_add").removeClass("ui-button-special-disabled").off().on("click",f.onTourPointAdd),a("#func_tour_confirm").removeClass("ui-button-special-disabled").off().on("click",function(){setTimeout(f.onTourConfirm,100)}),a("#func_tour_refresh").removeClass("ui-button-special-disabled").off().on("click",f.onTourRefresh)},_removeTour:function(b){A=b.Index,d.PTZ.removeTour(A+1).done(function(c){if(c&&c.result){k--,f.$("#func_zdxh_tip").tip("success",tl("com.OperateSuccessTip")),t[A].Enable=!1,webApp.DeviceType.indexOf("SD")>-1&&-1===webApp.DeviceType.indexOf("TPC")||(t[A].Name="None");for(var d=0;d<t[A].Presets.length;d++)t[A].Presets[d]=a.extend(!0,[],o);return g.table("del",b),0===k&&(a("#func_tour_start").addClass("ui-button-special-disabled").off(),f._emptyTourPointTable()),!1}f.$("#func_zdxh_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxh_tip").tip("error",tl("com.OperateFailTip"))})},_savePrevTourPoint:function(){j=h.table("dataSource");var a=null;i.forEach(function(b,c){b.Index===A&&(a=c)}),0!==j.length&&null!=a&&(i[a].tourPoint=j)},_showTourPointList:function(b){f._emptyTourPointTable();var c=!1,d=0;i.forEach(function(a,e){a.Index===b&&(c=!0,d=e)}),k&&c&&(j=i[d].tourPoint,0===j.length?a("#func_tour_start").addClass("ui-button-special-disabled").off():(a("#func_tour_start").removeClass("ui-button-special-disabled").off().on("click",f.onTourStart),h.table("dataSource",j)))},onTourStart:function(){return A=g.table("getSelectedData").Index,null===A||void 0===A?void f.$("#func_zdxh_tip").tip("warning",tl("com.NoTourSelectedTip")):(P._stopPtz(),w=!1,void setTimeout(function(){d.PTZ.startTour(A+1).done(function(b){b&&b.result?(a("#func_tour_start").hide(),a("#func_tour_stop").show(),f._onTourEstopAll()):f.$("#func_zdxh_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxh_tip").tip("error",tl("com.OperateFailTip"))})},100))},onTourStop:function(){A=g.table("getSelectedData").Index,d.PTZ.stopTour(A+1).done(function(b){b&&b.result?(a("#func_tour_stop").hide(),a("#func_tour_start").show(),w=!0,f._tourNormalStatus()):f.$("#func_zdxh_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxh_tip").tip("error",tl("com.OperateFailTip"))})},onTourAdd:function(){var b=t.length>n?n:t.length;if(k>=b)return void f.$("#func_zdxh_tip").tip("warning",tl("com.NoMoreTourTip"));for(var c=-1,d=0;k>d;d++)if(i[d].Index!==d){c=d;break}-1===c&&(c=k);var e={Name:tl("ivs.AutoTour")+(c+1),Index:c,tourPoint:[]};k++,g.table("add",e,c).table("selectRow",c),a("#func_tour_list_table .u-table-main").scrollTop(a("#func_tour_list_table tbody").find('[data-index="'+c+'"]').offset().top)},onTourPointAdd:function(){if(!k)return void f.$("#func_zdxh_tip").tip("warning",tl("com.AddTourFirstTip"));if(!s||0===s.length)return void f.$("#func_zdxh_tip").tip("warning",tl("com.AddPresetFirstTip"));var a=h.table("dataSource").length;if(a===t[A].Presets.length)return void f.$("#func_zdxh_tip").tip("warning",tl("com.NoMorePresetTip"));for(var b={duration:o[1],preset:1,speed:o[2]},c=0;m>=c;c++)if(c in l){b.preset=c;break}h.table("add",b,a)},onTourConfirm:function(){f._savePrevTourPoint(),i=g.table("dataSource"),t.each(function(b){b.Enable=!1,webApp.DeviceType.indexOf("SD")>-1&&-1===webApp.DeviceType.indexOf("TPC")||(b.Name="None"),b.Presets.each(function(c,d){b.Presets[d]=a.extend(!0,[],o)})}),r=0,i.each(function(b,c){t[b.Index].Enable=!0,i[c].Name=a.htmlEscapeReverse(i[c].Name),t[b.Index].Name=i[c].Name,O.test(i[c].Name)||r++,i[c].tourPoint.each(function(a,c){t[b.Index].Presets[c][0]=~~a.preset-1,t[b.Index].Presets[c][1]=~~a.duration,t[b.Index].Presets[c][2]=a.speed-0}),t[b.Index].Path=a("#func_zdxh_mode").val()});for(var b=[],c=0;c<webApp.CHANNEL_NUMBER;c++)b.push(t);return r>0?void f.$("#func_zdxh_tip").tip("error",tl("com.LimitStringInput")):void d.ConfigManager.setConfig("PtzTour",b).done(function(){f._showTourPointList(A),f.$("#func_zdxh_tip").tip("success",tl("com.OperateSuccessTip")),q&&"Short"===a("#func_zdxh_mode").val()&&(f.$("#func_zdxh_tip").tip("success",tl("ptz.MinimumPathTips")),setTimeout(function(){f.$("#func_zdxh_tip").tip("success",tl("com.OperateSuccessTip"))},1500)),i.each(function(b){b.Name=a.htmlEscape(b.Name)}),g.table("dataSource",i)}).fail(function(){f.$("#func_zdxh_tip").tip("error",tl("com.OperateFailTip"))})},onTourRefresh:function(){f._getTourConfig(!0)}})}),define("func_zdxs",function(require,b,c){var f=null,g=null,h=!0;c.exports=e.extend({init:function(){f=this,g=f.$("#zdxsSlider").slider({max:8,min:1,complete:function(){f._setScanSpeed()}}),webApp.isSpecialPtz&&f.$("#zdxsSlider").parent("div").hide(),f.render()},render:function(){P._getPtzCurmove().done(function(a){x=-1===a[0].Function.indexOf("Scan")||"WideViewScan"===a[0].Function,f.$("#func_scan_start").toggle(x),f.$("#func_scan_stop").toggle(!x),x?f._scanNormalStatus():(f._onScanEstopAll(),C=a[0].Index)}),P._getScanList().done(function(){f._showScanList()})},_onScanEstopAll:function(){f.$("#maskZdxsSelect,#maskZdxsSlider").removeClass("mask").addClass("mask-show"),a("#func_scan_setting").addClass("ui-button-special-disabled").off(),a("#func_scan_limit_left,#func_scan_limit_right").addClass("ui-button-disabled").off(),f.$("#func_zdxs_tip").tip("warning",tl("com.IsScaningTip"))},_scanNormalStatus:function(){a("#func_scan_setting").removeClass("ui-button-special-disabled").off().on("click",f.onScanSetting),a("#func_scan_limit_left").removeClass("ui-button-disabled").off().on("click",f.onScanLimitLeft),a("#func_scan_limit_right").removeClass("ui-button-disabled").off().on("click",f.onScanLimitRight),f.$("#maskZdxsSelect,#maskZdxsSlider").removeClass("mask-show").addClass("mask")},_showScanList:function(){a("#func_scan_number").empty();for(var b=u.length>p?p:u.length,c="",d=0;b>d;d++){var e=u[d].LeftEnable&&u[d].RightEnable?"black":"gray";c+='<option style="color:'+e+'" value="'+(d+1)+'">'+(d+1)+"</option>"}a("#func_scan_number").append(c).val(C+1),f._scanStartStopEnble()},_setScanSpeed:function(){u[C].ScanSpeed=g.slider("value")-1;for(var a=[],b=0;b<webApp.CHANNEL_NUMBER;b++)a.push(u);d.ConfigManager.setConfig("AutoScan",a).fail(function(){f.$("#func_zdxs_tip").tip("error",tl("com.SaveConfigFailTip"))})},_scanStartStopEnble:function(){u[C].LeftEnable&&u[C].RightEnable?(a("#func_scan_start").off().on("click",f.onScanStart),a("#func_scan_stop").off().on("click",f.onScanStop),a("#func_scan_start,#func_scan_stop").removeClass("ui-button-special-disabled")):a("#func_scan_start,#func_scan_stop").addClass("ui-button-special-disabled").off(),g.slider("value",u[C].ScanSpeed+1)},onScanNumberChange:function(){C=a("#func_scan_number").val()-1,f._scanStartStopEnble()},onScanStart:function(){P._stopPtz(),setTimeout(function(){d.PTZ.startScan(C+1,g.slider("value")-1).done(function(b){b&&b.result?(a("#func_scan_start").hide(),a("#func_scan_stop").show(),x=!1,f._onScanEstopAll()):f.$("#func_zdxs_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxs_tip").tip("error",tl("com.OperateFailTip"))})},100)},onScanStop:function(){d.PTZ.stopScan(C+1).done(function(b){b&&b.result?(a("#func_scan_start").show(),a("#func_scan_stop").hide(),x=!0,f._scanNormalStatus()):f.$("#func_zdxs_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxs_tip").tip("error",tl("com.OperateFailTip"))})},onScanSetting:function(){h?a("#func_scan_limit_wrap").show():a("#func_scan_limit_wrap").hide(),h=!h},onScanLimitLeft:function(){d.PTZ.setScanLimit(C+1,"Left").done(function(a){a&&a.result?(u[C].LeftEnable=!0,f.render(),f.$("#func_zdxs_tip").tip("success",tl("com.OperateSuccessTip"))):f.$("#func_zdxs_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxs_tip").tip("error",tl("com.OperateFailTip"))})},onScanLimitRight:function(){d.PTZ.setScanLimit(C+1,"Right").done(function(a){a&&a.result?(u[C].RightEnable=!0,f.render(),f.$("#func_zdxs_tip").tip("success",tl("com.OperateSuccessTip"))):f.$("#func_zdxs_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxs_tip").tip("error",tl("com.OperateFailTip"))})}})}),define("func_zdxj",function(require,b,c){var f=null,g=!0;c.exports=e.extend({init:function(){f=this,f.render()},render:function(){P._getPtzCurmove().done(function(a){y="Pattern"!==a[0].Function,f.$("#func_pattern_start").toggle(y),f.$("#func_pattern_stop").toggle(!y),y?f._patternNormalStatus():(f._onPatternEstopAll(),B=a[0].Index)}),P._getPatternList().done(function(){f._showPatternList()})},_onPatternEstopAll:function(){f.$("#maskZdxjSelect").removeClass("mask").addClass("mask-show"),f.$("#func_zdxj_tip").tip("warning",tl("com.IsPatterningTip")),a("#func_pattern_setting,#func_pattern_record_start,#func_pattern_record_stop").addClass("ui-button-special-disabled").off()},_patternNormalStatus:function(){a("#func_pattern_setting").removeClass("ui-button-special-disabled").off().on("click",f.onPatternSetting),a("#func_pattern_record_start").removeClass("ui-button-special-disabled").off().on("click",f.onPatternRecordStart),a("#func_pattern_record_stop").removeClass("ui-button-special-disabled").off().on("click",f.onPatternRecordStop),f.$("#maskZdxjSelect").removeClass("mask-show").addClass("mask")},_showPatternList:function(){a("#func_pattern_number").empty();for(var b=v.length>o?o:v.length,c="",d=0;b>d;d++)color=v[d].Enable?"black":"gray",c+='<option style="color:'+color+'" value="'+(d+1)+'">'+(d+1)+"</option>";a("#func_pattern_number").append(c).val(B+1),v[B].Enable?(a("#func_pattern_start").off().on("click",f.onPatternStart),a("#func_pattern_stop").off().on("click",f.onPatternStop),a("#func_pattern_start,#func_pattern_stop").removeClass("ui-button-special-disabled")):a("#func_pattern_start,#func_pattern_stop").addClass("ui-button-special-disabled").off()},onPatternNumberChange:function(){B=a("#func_pattern_number").val()-1,v[B].Enable?(a("#func_pattern_start").off().on("click",f.onPatternStart),a("#func_pattern_stop").off().on("click",f.onPatternStop),a("#func_pattern_start,#func_pattern_stop").removeClass("ui-button-special-disabled")):a("#func_pattern_start,#func_pattern_stop").addClass("ui-button-special-disabled").off()},onPatternStart:function(){P._stopPtz(),setTimeout(function(){d.PTZ.startPatternReplay(B+1).done(function(b){b&&b.result?(a("#func_pattern_start").hide(),a("#func_pattern_stop").show(),y=!1,f._onPatternEstopAll()):f.$("#func_zdxj_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxj_tip").tip("error",tl("com.OperateFailTip"))})},100)},onPatternStop:function(){d.PTZ.stopPatternReplay(B+1).done(function(b){b&&b.result?(a("#func_pattern_start").show(),a("#func_pattern_stop").hide(),y=!0,f._patternNormalStatus()):f.$("#func_zdxj_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxj_tip").tip("error",tl("com.OperateFailTip"))})},onPatternSetting:function(){g?a("#func_pattern_record_wrap").show():a("#func_pattern_record_wrap").hide(),g=!g},onPatternRecordStart:function(){d.PTZ.startPatternRecord(B+1,"pattern1").fail(function(){f.$("#func_zdxj_tip").tip("error",tl("com.OperateFailTip"))})},onPatternRecordStop:function(){d.PTZ.stopPatternRecord(B+1).done(function(a){a&&a.result?P._getPatternList().done(function(){f._showPatternList()}):f.$("#func_zdxj_tip").tip("error",tl("com.OperateFailTip"))}).fail(function(){f.$("#func_zdxj_tip").tip("error",tl("com.OperateFailTip"))})}})}),define("func_spxz",function(require,b,c){var f,g=null,h=null,i=null,j=null,k=null,l=!1;c.exports=e.extend({init:function(){g=this,q?(k=g.$("#func_spxz_tpc_table").table({height:240,columns:[{t:"com.Number",width:"15%",fields:"index"},{t:"com.Name",fields:"Name",width:"20%",editor:function(){return a('<input type="text" class="u-input"/>').textfield({length:31,asciiByte:2,notAsciiByte:3,validReg:/^[^\"*<>?|&\/]+$/,errorHandle:"prevent"})}},{t:"itc.Speed",fields:"Speed",width:"15%",editor:function(){return a('<input type="text" class="u-input"/>').numberfield({min:1,max:64,allowDecimal:!1,allowNegative:!1})}},{t:"ivs.IntervalTime",fields:"Interval",width:"20%",editor:function(){return a('<input type="text" class="u-input"/>').numberfield({min:0,max:300,allowDecimal:!1,allowNegative:!1})}},{t:"com.Save",width:"15%",action:"save",icon:"i-save",handle:function(b){var c=a.extend(!0,{},b);c.Speed=~~c.Speed,c.Interval=~~c.Interval,delete c.__id,delete c._index,d.PtzFunc.setPanGroup(0,c).done(function(){g.$("#func_spxz_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("com.SaveConfigFailTip"))})}},{t:"com.Delete",width:"15%",action:"deleteyzd",icon:"i-del",handle:function(b){var c=this,e=a.extend(!0,{},b);e.Enable=!1,e.Speed=e.Speed-0,delete e.__id,delete e._index,d.ConfigManager.getConfig("PtzMovement").done(function(a){return"AutoPan"===a[0].Function?void g.$("#func_spxz_tip").tip("warning",tl("isAutopaning")):(c.del(b),void d.PtzFunc.setPanGroup(0,e).done(function(){g.$("#func_spxz_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("com.SaveConfigFailTip"))}))})}}],onRowSelect:function(a,b){d.PtzFunc.gotoPanPosition(0,b.data.index)}}),ability.get("FireWarning").then(function(a){a&&a.Support&&(l=!0,g.$("#func_ptzlimitset_wrap").show())})):j=g.$("#spxzSlider").slider({min:1,max:8,complete:function(){g._setAutoPanSpeed()}}),g.render()},_renderSpxzTable:function(b){g.$("#spxzSlider,#spxzSliderLabel").hide(),g.$('[btn-for="onSpxzStart"]').parent().removeClass("fn-marl90"),d.PtzFunc.getPanGroup(0).done(function(c){i=c.panGroupInfo,i.each(function(a,b){a.index=b+1}),f=a.extend(!0,[],i).filter(function(a){return a.Enable}),k.table("dataSource",f),b&&z&&g.$("#func_spxz_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){b&&z&&g.$("#func_spxz_tip").tip("error",tl("com.OperateFailTip"))}),l===!0&&d.ConfigManager.getConfig("PanGroupScan").done(function(a){a[0].LimitEnable===!0&&0===a[0].LimitMode&&(g.$("#func_spxz_enable_leftRight").prop("checked",!0),g.$("#func_spxz_limit_up,#func_spxz_limit_down").addClass("ui-button-disabled")),a[0].LimitEnable===!0&&1===a[0].LimitMode&&g.$("#func_spxz_enable_road").prop("checked",!0),a[0].LimitEnable===!1&&g.$("#func_spxz_limit_left,#func_spxz_limit_right,#func_spxz_limit_up,#func_spxz_limit_down").addClass("ui-button-disabled")})},_renderSpxzSlider:function(a){g.$('[btn-for="onSpxzTPCAdd"]').hide(),g.$('[btn-for="onSpxzTPCRefresh"]').hide(),g.$("#func_spxz_tpc_table").hide(),d.ConfigManager.getConfig("AutoPan").done(function(a){h=a[0],j.slider("value",h.PanSpeed+1)}).fail(function(){a&&g.$("#func_spxz_tip").tip("error",tl("com.OperateFailTip"))})},render:function(){q?g._renderSpxzTable():g._renderSpxzSlider(),P._getPtzCurmove().done(function(a){z=-1===a[0].Function.indexOf("AutoPan"),g._maskSpxzEnble(z?!1:!0)
})},_setAutoPanSpeed:function(){h.PanSpeed=j.slider("value")-1;for(var a=[],b=0;b<webApp.CHANNEL_NUMBER;b++)a.push(h);d.ConfigManager.setConfig("AutoPan",a).fail(function(){g.$("#func_spxz_tip").tip("error",tl("com.SaveConfigFailTip"))})},_maskSpxzEnble:function(a){a?(g.$('[btn-for="onSpxzTPCRefresh"],[btn-for="onSpxzTPCAdd"]').prop("disabled",!0).addClass("ui-button-special-disabled"),g.$("#maskSpxzSlider").removeClass("mask").addClass("mask-show"),i&&g.$("#maskSpxzSlider").css({height:"245px",width:"400px",left:"0px"}),g.$('[btn-for="onSpxzStart"]').hide(),g.$('[btn-for="onSpxzStop"]').show(),g.$("#func_spxz_tip").tip("warning",tl("com.IsAutopaningTip"))):(g.$('[btn-for="onSpxzTPCRefresh"]').prop("disabled",!1).removeClass("ui-button-special-disabled"),g.$('[btn-for="onSpxzTPCAdd"]').prop("disabled",!1).removeClass("ui-button-special-disabled"),g.$("#maskSpxzSlider").removeClass("mask-show").addClass("mask"),g.$('[btn-for="onSpxzStart"]').show(),g.$('[btn-for="onSpxzStop"]').hide())},onSpxzStart:function(){P._stopPtz(),setTimeout(function(){d.PTZ.start("AutoPanOn",0,0,0).done(function(a){a&&a.result&&(z=!1,g._maskSpxzEnble(!0))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("com.OperateFailTip"))})},100)},onSpxzStop:function(){d.PTZ.start("AutoPanOff",0,0,0).done(function(a){a&&a.result&&(z=!0,g._maskSpxzEnble(!1))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("com.OperateFailTip"))})},onSpxzTPCAdd:function(){var a=0;if(f.length<q){f.sort(function(a,b){return a.Index-b.Index});for(var b=0;b<f.length;b++)if(f[b].index!=b+1){a=b+1;break}0===a&&(a=f.length+1);var c={index:a,Enable:!0,Name:tl("per.Rotation")+a,Speed:5,Interval:60};k.table("add",c,a-1)}else g.$("#func_spxz_tip").tip("warning",tl("per.AutoPanGroupMax"))},onSpxzTPCRefresh:function(){g._renderSpxzTable(!0)},onSpxzLimitEnableLeftRight:function(){var a=g.$("#func_spxz_enable_leftRight").prop("checked");g.$("#func_spxz_limit_left,#func_spxz_limit_right,#func_spxz_limit_up,#func_spxz_limit_down").removeClass("ui-button-current"),a?(g.$("#func_spxz_limit_left,#func_spxz_limit_right").removeClass("ui-button-disabled"),g.$("#func_spxz_limit_up,#func_spxz_limit_down").addClass("ui-button-disabled"),g.$("#func_spxz_enable_road").prop("checked",!1)):g.$("#func_spxz_limit_left,#func_spxz_limit_right,#func_spxz_limit_up,#func_spxz_limit_down").addClass("ui-button-disabled");var b=a?!0:!1,c={LimitEnable:b,LimitMode:0};d.ConfigManager.setConfig("PanGroupScan",[c]).done(function(){g.$("#func_spxz_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("Operateingfailure"))})},onSpxzLimitEnableRoad:function(){var a=g.$("#func_spxz_enable_road").prop("checked");g.$("#func_spxz_limit_left,#func_spxz_limit_right,#func_spxz_limit_up,#func_spxz_limit_down").removeClass("ui-button-current"),a?(g.$("#func_spxz_limit_up,#func_spxz_limit_down,#func_spxz_limit_left,#func_spxz_limit_right").removeClass("ui-button-disabled"),g.$("#func_spxz_enable_leftRight").prop("checked",!1)):g.$("#func_spxz_limit_up,#func_spxz_limit_down,#func_spxz_limit_left,#func_spxz_limit_right").addClass("ui-button-disabled");var b=a?!0:!1,c={LimitEnable:b,LimitMode:1};d.ConfigManager.setConfig("PanGroupScan",[c]).done(function(){g.$("#func_spxz_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("Operateingfailure"))})},onSpxzLimitLeft:function(){return g.$("#func_spxz_enable_leftRight").prop("checked")||g.$("#func_spxz_enable_road").prop("checked")?void d.PtzFunc.setPanGroupLimit(0,1,"Left").done(function(){g.$("#func_spxz_limit_left").addClass("ui-button-current"),g.$("#func_spxz_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("Operateingfailure"))}):!1},onSpxzLimitRight:function(){return g.$("#func_spxz_enable_leftRight").prop("checked")||g.$("#func_spxz_enable_road").prop("checked")?void d.PtzFunc.setPanGroupLimit(0,1,"Right").done(function(){g.$("#func_spxz_limit_right").addClass("ui-button-current"),g.$("#func_spxz_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("Operateingfailure"))}):!1},onSpxzLimitUp:function(){return g.$("#func_spxz_enable_road").prop("checked")?void d.PtzFunc.setPanGroupLimit(0,1,"Up").done(function(){g.$("#func_spxz_limit_up").addClass("ui-button-current"),g.$("#func_spxz_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("Operateingfailure"))}):!1},onSpxzLimitDown:function(){return g.$("#func_spxz_enable_road").prop("checked")?void d.PtzFunc.setPanGroupLimit(0,1,"Down").done(function(){g.$("#func_spxz_limit_down").addClass("ui-button-current"),g.$("#func_spxz_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){g.$("#func_spxz_tip").tip("error",tl("Operateingfailure"))}):!1}})}),define("func_ytsd",function(require,b,c){var f=null,g=null;c.exports=e.extend({init:function(){f=this,f.bind(),f.render()},bind:function(){f.$('input[name="func_ptzspeed"]').on("click",function(){g.PtzSpeed=a("#func_ptzspeed_low").prop("checked")?0:a("#func_ptzspeed_middle").prop("checked")?1:2;for(var b=[],c=0;c<webApp.CHANNEL_NUMBER;c++)b.push(g);d.ConfigManager.setConfig("PtzSpeed",b).done(function(){f.$("#func_ytsd_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){f.$("#func_ytsd_tip").tip("error",tl("com.SaveConfigFailTip"))})})},render:function(){d.ConfigManager.getConfig("PtzSpeed").done(function(b){switch(g=b[0],g.PtzSpeed){case 0:a("#func_ptzspeed_low").prop("checked",!0);break;case 1:a("#func_ptzspeed_middle").prop("checked",!0);break;case 2:a("#func_ptzspeed_high").prop("checked",!0)}})}})}),define("func_kxdz",function(require,b,c){var f=null,g=null;c.exports=e.extend({init:function(){f=this,f.$("#func_idle_time").numberfield({max:60,min:1,allowDecimal:!1,allowNegative:!1}),q&&f.$('input[key="AutoPanGroup"]').parent().parent().show(),f.render(),f.bind()},render:function(a){d.ConfigManager.getConfig("IdleMotion").done(function(b){g=b[0],f._initIdleSelect(),a&&f.$("#func_kxdz_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){a&&f.$("#func_kxdz_tip").tip("error",tl("com.OperateFailTip"))})},bind:function(){f.$("input[key]").on("click",function(b){f._idleRenderElements(a(b.target).attr("key"))})},_initIdleSelect:function(){a.when(P._getPtzPresets(!0),P._getTourList(!0),P._getScanList(!0),P._getPatternList(!0)).done(function(){f.$('select[key="Preset"]').empty().append(E),f.$('select[key="Tour"]').empty().append(F),f.$('select[key="Scan"]').empty().append(G),f.$('select[key="Pattern"]').empty().append(H),L.each(function(a){f.$("[name=func_idle][key="+a+"]").prop("checked",!1),f.$("[name=func_idle][key="+a+"]").parent().parent().removeClass("fn-hide")}),f._idleRenderElements(g.Function,!0)})},_idleRenderElements:function(a,b){var c=f.$('select[key="'+a+'"]');if(b&&(f.$("#func_idle_enable").prop("checked",g.Enable),f.$('input[key="'+a+'"]').prop("checked",!0)),f.$("select[key]").parent().hide(),"-1"!==c.val()){var d;d=webApp.isSpecialPtz?g[a+"Id"]:"Preset"===a?g[a+"Id"]:g[a+"Id"]+1,c.val(d).parent().show(),c.val()||c.find("option:first").prop("selected","selected")}f.$("#func_idle_time").numberfield("value",g.Timer)},onIdleConfirm:function(){var b="None",c=!1,e=null;return g.Enable=f.$("#func_idle_enable").prop("checked"),f.$("input[key]").each(function(d,h){if(a(h).prop("checked")){if(b=a(h).attr("key"),e=~~f.$('select[key="'+b+'"]').val(),-1===e)return c=!0,!1;g.Function=b,g[b+"Id"]=webApp.isSpecialPtz?e-0:"Preset"===b?e-0:e-1}}),c?void f.$("#func_kxdz_tip").tip("warning",tl(N[b])):(g.Timer=a("#func_idle_time").numberfield("value"),void d.ConfigManager.setConfig("IdleMotion",[g]).done(function(){f.$("#func_kxdz_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){f.$("#func_kxdz_tip").tip("error",tl("com.SaveConfigFailTip"))}))},onIdleRefresh:function(){f.render(!0)}})}),define("func_kjdz",function(require,b,c){var f=null,g=null;c.exports=e.extend({init:function(){f=this,q&&f.$('input[key="AutoPanGroup"]').parent().parent().show(),f.render(),f.bind()},render:function(a){d.ConfigManager.getConfig("PowerUp").done(function(b){g=b[0],f._initPowerupSelect(),a&&f.$("#func_kjdz_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){a&&f.$("#func_kjdz_tip").tip("error",tl("com.OperateFailTip"))})},bind:function(){f.$("input[key]").on("click",function(b){f._powerUpRenderElements(a(b.target).attr("key"))})},_powerUpRenderElements:function(a,b){var c=f.$('select[key="'+a+'"]');if(b&&(f.$("#func_powerup_enable").prop("checked",g.Enable),f.$('input[key="'+a+'"]').prop("checked",!0)),f.$("select[key]").parent().hide(),"-1"!==c.val()){var d="Preset"===a?g[a+"Id"]:g[a+"Id"]+1;c.val(d).parent().show(),c.val()||c.find("option:first").prop("selected","selected")}},_initPowerupSelect:function(){a.when(P._getPtzPresets(!0),P._getTourList(!0),P._getScanList(!0),P._getPatternList(!0)).done(function(){f.$('select[key="Preset"]').empty().append(E),f.$('select[key="Tour"]').empty().append(F),f.$('select[key="Scan"]').empty().append(G),f.$('select[key="Pattern"]').empty().append(H),M.each(function(a){f.$("[name=func_powerup][key="+a+"]").parent().parent().removeClass("fn-hide")}),f._powerUpRenderElements(g.Function,!0)})},onPowerUpConfirm:function(){var b="None",c=!1,e=null;return g.Enable=f.$("#func_powerup_enable").prop("checked"),f.$("input[key]").each(function(d,h){if(a(h).prop("checked")){if(b=a(h).attr("key"),e=~~f.$('select[key="'+b+'"]').val(),-1===e)return c=!0,!1;g.Function=b,g[b+"Id"]="Preset"===b?e-0:e-1}}),c?void f.$("#func_kjdz_tip").tip("warning",tl(N[b])):void d.ConfigManager.setConfig("PowerUp",[g]).done(function(){f.$("#func_kjdz_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){f.$("#func_kjdz_tip").tip("error",tl("com.SaveConfigFailTip"))})},onPowerUpRefresh:function(){f.render(!0)}})}),define("func_limit",function(require,b,c){var f=null,g=null,h=null,i=null,j=null;c.exports=e.extend({init:function(){f=this;var a=f.$("#func_limit_Elevation");if(l.PtzElevation&&(j=l.PtzElevation.Support||!1,i=l.PtzElevation.AngleRange||[0,-200]),j){f.$('[data-cap="PtzElevation"]').removeClass("fn-hide"),a.empty();for(var b="",c=i[0];c>=i[1];c-=10)b+="<option value="+c+">"+c/10+"Â°</option>";a.append(b)}l.PtzLimit.Support||f.$('div[data-cap="PtzLimit"]').addClass("fn-hide"),f.bind(),f.render()},render:function(){d.ConfigManager.getConfig("PtzLimit").done(function(a){g=a[0],f.$("#func_limit_enable").prop("checked",g.Enable),f._renderElements(g)}).fail(function(){f.$("#func_limit_tip").tip("error",tl("com.OperateFailTip"))}),d.ConfigManager.getConfig("VideoWidget").done(function(b){b[0].PTZCoordinates.EncodeBlend||a("#func_limitTip_wrap").removeClass("fn-hide")}),j&&d.ConfigManager.getConfig("PtzElevation").done(function(b){h=b,a("#func_limit_Elevation").val(h[0].ElevationAngle||0)}).fail(function(){f.$("#func_limit_tip").tip("error",tl("com.OperateFailTip"))})},bind:function(){f.$("#func_limit_enable").on("click",f._onLimitEnable),f.$("a[data-type]").on("click",f._onLimitBtn)},_onLimitEnable:function(){var a=f.$("#func_limit_enable").prop("checked");g.Enable=a,f._renderElements(g),d.PTZ.enableLimit(a).done(function(){f.$("#func_limit_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){f.$("#func_limit_tip").tip("error",tl("com.OperateFailTip"))})},_renderElements:function(a){var b={Enable:-1,UpLimit:0,DownLimit:1,LeftLimit:2,RightLimit:3,EnlargeLimit:4,ShrinkLimit:5};f.$('a[data-func="prev"]').addClass("ui-button-disabled"),a.Enable?f.$('a[data-func="set"]').addClass("ui-button-disabled"):f.$('a[data-func="set"]').removeClass("ui-button-disabled");for(var c in a){var d=b[c];a[c]&&a[c].Enable&&f.$('a[data-func="prev"][data-type="'+d+'"]').removeClass("ui-button-disabled")}},_onLimitBtn:function(){var b=a(this),c=b.attr("data-func"),d=b.attr("data-type");if(!b.hasClass("ui-button-disabled"))switch(c){case"set":f._onLimitSet(d);break;case"prev":f._onLimitPreview(d)}},_onLimitSet:function(a){a-=0;var b=["UpLimit","DownLimit","LeftLimit","RightLimit","EnlargeLimit","ShrinkLimit"];d.PTZ.markLimit(a).done(function(){f.$("#func_limit_tip").tip("success",tl("com.OperateSuccessTip")),void 0===g[b[a]]&&(g[b[a]]={}),g[b[a]].Enable=!0,f.$('a[data-func="prev"][data-type="'+a+'"]').removeClass("ui-button-disabled")}).fail(function(){f.$("#func_limit_tip").tip("error",tl("com.OperateFailTip"))})},_onLimitPreview:function(a){a-=0,d.PTZ.gotoLimit(a).done(function(){f.$("#func_limit_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){f.$("#func_limit_tip").tip("error",tl("com.OperateFailTip"))})},onLimitEleChange:function(){return 0===h.length?void f.$("#func_limit_tip").tip("error",tl("com.OperateFailTip")):(h[0].ElevationAngle=a("#func_limit_Elevation").val()-0,void d.ConfigManager.setConfig("PtzElevation",h).fail(function(){f.$("#func_limit_tip").tip("success",tl("com.OperateSuccessTip"))}))}})}),define("func_dsrw",function(require,b,c){var f,h=null,i=null,j=require("jsCore/modules/timeSection"),k=[],l=["0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"];c.exports=e.extend({init:function(){h=this,f=0,h.$("#func_tt_snapDelay_time").numberfield({min:0,max:600,allowDecimal:!1,allowNegative:!1}),h.$("#func_tt_autohome_time").numberfield({min:5,max:3600,allowDecimal:!1,allowNegative:!1});for(var a=0;7>a;a++)k.push(l);q&&h.$('input[key="AutoPanGroup"]').parent().parent().show(),h.render(),h.bind()},render:function(a){d.ConfigManager.getConfig("PtzAutoMovement").done(function(b){D=b[0],h._initSelect(),a&&h.$("#func_dsrw_tip").tip("success",tl("com.OperateingSuccessTip"))})},bind:function(){h.$("input[key]").on("click",function(b){var c=a(b.target).attr("key"),d=h.$('select[key="'+c+'"]');h.$("#tt_action").val(c),h.$("#func_tt_snap,#func_tt_snapDelay").toggle("Preset"===c),h.$("select[key]").parent().hide(),"-1"!==d.val()&&d.parent().show()})},_initSelect:function(){a.when(P._getPtzPresets(!0),P._getTourList(!0),P._getScanList(!0),P._getPatternList(!0)).done(function(){h.$('select[key="Preset"]').empty().append(E),h.$('select[key="Tour"]').empty().append(F),h.$('select[key="Scan"]').empty().append(G),h.$('select[key="Pattern"]').empty().append(H),h._initDom(),h._renderOneTask(f)})},_initDom:function(){i=r.TaskNum,r.SupportSnapShot&&a("#func_tt_capSnapShot").removeClass("fn-hide"),r.Action.each(function(b){var c=".capAction"+b;a(c).removeClass("fn-hide")});for(var b="",c=0;i>c;c++)b+='<option value="'+c+'">'+(c+1)+"</option>";h.$("#func_tt_number,#func_copytask_num").empty().append(b),h.$("#func_tt_number").val(f)},_renderOneTask:function(a){h.$("#func_tt_enable").prop("checked",D[a].Enable),h.$("#func_tt_autohome_time").numberfield("value",D[a].AutoHoming.Time),h.$("#tt_action").val(D[a].Function),h.$("#func_tt_snap,#func_tt_snapDelay").hide(),h.$("select[key]").parent().hide();var b,c=h.$("#tt_action").val(),d=h.$('select[key="'+c+'"]');h.$("input[key]").prop("checked",!1),h.$('input[key="'+c+'"]').prop("checked",!0),"-1"!==d.val()&&("Preset"===c&&(h.$("#func_tt_SnapshotEnable").prop("checked",D[a].SnapshotEnable),h.$("#func_tt_snap,#func_tt_snapDelay").show()),b=-1!==webApp.DeviceType.indexOf("TPC")?"Preset"===c?D[a][c+"Id"]:D[a][c+"Id"]+1:D[a][c+"Id"],d.val(b).parent().show())},_initTask:function(a){D[a].Enable=!1,D[a].Function="None",D[a].PresetId=0,D[a].ScanId=0,D[a].PatternId=0,D[a].TourId=0,D[a].TimeSection=k,D[a].AutoHoming.Enable=!0,D[a].AutoHoming.Time=30,D[a].SnapshotEnable=!1,D[a].SnapshotDelayTime=30},onChangeTaskNum:function(){f=a("#func_tt_number").val()-0,h._renderOneTask(f)},onClearAllConfig:function(){for(var a=0;i>a;a++)h._initTask(a);d.ConfigManager.setConfig("PtzAutoMovement",[D,D]).done(function(){h._renderOneTask(f),h.$("#func_dsrw_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){h.$("#func_dsrw_tip").tip("error",tl("com.SaveConfigFailTip"))})},onSetPeriod:function(){f=a("#func_tt_number").val()-0,g.hide();var b=D[f];j.open(b.TimeSection,{title:"com.Setup"}).done(function(a){b.TimeSection=a,g.cover("#func_video")}).always(function(){g.cover("#func_video")})},onCopyTask:function(){var b=a("#func_tt_number").val()-0,c=a("#func_copytask_num").val()-0;c!==b&&(h.$("#func_dsrw_tip").tip("success",tl("com.OperateingSuccessTip")),D[c]=a.extend(!0,{},D[b]),a("#func_tt_number").val(c),h._renderOneTask(f))},_checkTime:function(b,c){var d=!1,e={enable:null,stTime:null,edTime:null},f=a.extend(!0,{},e);return a.each(b,function(b,g){return a.each(g,function(g,i){return h._splitTime(i,e),e.enable&&a.each(c[b],function(a,b){return h._splitTime(b,f),f.enable&&!(f.edTime<e.stTime||e.edTime<f.stTime)?(d=!0,!1):void 0}),d?!1:void 0}),d?!1:void 0}),d},_checkNull:function(b){var c=!1,d={enable:null,stTime:null,edTime:null},e=null;return c=!1,a.each(b.TimeSection,function(a,b){return e=b.filter(function(a){return h._splitTime(a,d),0!==d.enable&&d.stTime!==d.edTime}),c=0===e.length?!0:!1,c===!1?!1:void 0}),c},_splitTime:function(a,b){var c=null,d=null,e=null,f=null;c=a.split(" "),b.enable=c[0]-0,d=c[1].split("-"),e=d[0].split(":").map(function(a){return a-0}),f=d[1].split(":").map(function(a){return a-0}),b.stTime=3600*e[0]+60*e[1]+e[2],b.edTime=3600*f[0]+60*f[1]+f[2]},onResetThisTask:function(){var b=a("#func_tt_number").val()-0;a("#func_tt_enable").prop("checked",!1),h._initTask(b),h._renderOneTask.delay(200),d.ConfigManager.setConfig("PtzAutoMovement",[D]).done(function(){setTimeout(function(){h._renderOneTask()},200),h.$("#func_dsrw_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){h.$("#func_dsrw_tip").tip("error",tl("com.SaveConfigFailTip"))})},onSaveThisTask:function(){var b=h.$("#func_tt_number").val()-0,c=h.$("#tt_action").val(),e=!1,f=!1,g=null;return D[b].Enable=h.$("#func_tt_enable").prop("checked"),D[b].AutoHoming.Time=h.$("#func_tt_autohome_time").numberfield("value"),D[b].Function=c,D[b].PresetId=0,D[b].TourId=0,D[b].ScanId=0,D[b].PatternId=0,D[b].SnapshotEnable=!1,h.$("input[key]").each(function(d,f){if(a(f).prop("checked")){if(g=~~h.$('select[key="'+c+'"]').val(),-1===g)return e=!0,!1;"Preset"===c?(D[b][c+"Id"]=g-0,D[b].SnapshotEnable=h.$("#func_tt_SnapshotEnable").prop("checked"),D[b].SnapshotDelayTime=h.$("#func_tt_snapDelay_time").val()-0):D[b][c+"Id"]=-1!==webApp.DeviceType.indexOf("TPC")?g-1:g-0}}),e?void h.$("#func_dsrw_tip").tip("warning",tl(N[c])):D[b].Enable===!0&&h._checkNull(D[b])?(D[b].Enable=!1,void h.$("#func_dsrw_tip").tip("error",tl("com.TaskErrorTip"))):(a.each(D,function(a,c){return a!==b&&c.Enable===!0&&h._checkTime(D[b].TimeSection,c.TimeSection)?(f=!0,!1):void 0}),f?void h.$("#func_dsrw_tip").tip("error",tl("com.TaskErrorTip")):void d.ConfigManager.setConfig("PtzAutoMovement",[D]).done(function(){h.$("#func_dsrw_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){h.$("#func_dsrw_tip").tip("error",tl("com.SaveConfigFailTip"))}))},onRefreshThisTask:function(){h.render(!0)}})}),define("func_zsdh",function(require,a,b){var c=null,f=0,g=null;b.exports=e.extend({init:function(){c=this,c.render()},render:function(){c._getConfig(!1)},_renderDom:function(){g&&c.$("[sel-for=onLevel]").val(g[f].Level)},onLevel:function(a){g&&(g[f].Level=c.$(a.target).val())},onPowerLevelConfirm:function(){d.ConfigManager.setConfig("PtzPowerLevel",g).done(function(){c.$("#func_zsdh_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){c.$("#func_zsdh_tip").tip("error",tl("com.SaveConfigFailTip"))})},onPowerLevelRefresh:function(){c._getConfig(!0)},_getConfig:function(a){d.ConfigManager.getConfig("PtzPowerLevel").done(function(b){g=b,c._renderDom(),a&&c.$("#func_zsdh_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){c.$("#func_zsdh_tip").tip("error",tl("com.OperateFailTip"))})}})}),define("func_ytzn",function(require,a,b){var c=null,f=0,g=60,h=null,i=null,j=!1,k=!1;b.exports=e.extend({init:function(){c=this,c.$("#func_continue_time").numberfield({max:300,min:5,allowDecimal:!1,allowNegative:!1}),K.SupportPanoramicTrace?(c.$("#func_autoTrack").removeClass("fn-hide"),j=!0):c.$("#func_autoTrack").hide(),K.TrackOverProcessDelay&&K.TrackOverProcessDelay.Support?(c.$("#func_trackDelay").removeClass("fn-hide"),g=K.TrackOverProcessDelay.MaxDelay,k=!0):c.$("#func_trackDelay").hide(),c.$("#func_trackDelay_time").numberfield({max:g,min:0,allowDecimal:!1,allowNegative:!1}),c.$("#func_trackDelay_time_value").text("(0~"+g+")"),c.render()},render:function(a){d.ConfigManager.getConfig(["PanoramicTrace","PtzIntelliTrack"]).done(function(b){h=b[0].params.table,i=b[1].params.table,j&&(c.$("#func_ivstrack_enable").prop("checked",h[f].Enable),c.$("#func_continue_time").val(h[f].Duration)),k&&c.$("#func_trackDelay_time").val(i[f].TrackOverProcessDelay),a&&c.$("#func_ivsIntelli_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){c.$("#func_ivsIntelli_tip").tip("error",tl("com.OperateFailTip"))})},onIvsIntelliConfirm:function(){var a=[],b=[];k&&(i[f].TrackOverProcessDelay=c.$("#func_trackDelay_time").val()-0,a.push("PtzIntelliTrack"),b.push(i)),j&&(h[f].Enable=c.$("#func_ivstrack_enable").prop("checked"),h[f].Duration=c.$("#func_continue_time").val()-0,a.push("PanoramicTrace"),b.push(h)),d.ConfigManager.setConfig(a,b).done(function(){c.$("#func_ivsIntelli_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){c.$("#func_ivsIntelli_tip").tip("error",tl("com.OperateFailTip"))})},onIvsIntelliRefresh:function(){c.render(!0)}})}),define("func_ytcq",function(require,a,b){var c=null;b.exports=e.extend({init:function(){c=this},onPtzRestart:function(){d.PTZ.restartPtz().done(function(a){a&&a.result&&c.$("#func_ytcq_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){c.$("#func_ytcq_tip").tip("error",tl("com.OperateFailTip"))})}})}),define("func_jxcq",function(require,a,b){var c=null;b.exports=e.extend({init:function(){c=this},onCameraRestart:function(){d.PTZ.restartCamera().done(function(a){a&&a.result&&c.$("#func_jxcq_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){c.$("#func_jxcq_tip").tip("error",tl("com.OperateFailTip"))})}})}),define("func_hfmr",function(require,a,b){var c=null;b.exports=e.extend({init:function(){c=this},onDefault:function(){c.$("#func_hfmr_tip").tip("warning",tl("com.WaitConfigEffectedTip")),d.PTZ.reset().done(function(a){a&&a.result&&(s=[],t=[],v=[],u=[],D=[],C=0,B=0,A=0,c.$("#func_hfmr_tip").tip("success",tl("com.OperateSuccessTip")))}).fail(function(){c.$("#func_hfmr_tip").tip("error",tl("com.OperateFailTip"))}).always(function(){webApp.isNeedReboot(options)&&webApp.reboot("com.ConfEffectRestartTip")})}})})})}(jQuery);